# App2 - Tokio HTTP Server (MVC Architecture)

ä¸€ä¸ªä½¿ç”¨ Tokio å’Œ Hyper æ„å»ºçš„å¼‚æ­¥ HTTP æœåŠ¡å™¨ï¼Œé‡‡ç”¨ MVC æ¶æ„æ¨¡å¼ã€‚

## ğŸ—ï¸ æ¶æ„ç‰¹ç‚¹

- âœ… **MVC æ¶æ„** - æ¸…æ™°çš„åˆ†å±‚è®¾è®¡
- âœ… **å¼‚æ­¥å¤„ç†** - åŸºäº Tokio è¿è¡Œæ—¶
- âœ… **RESTful API** - æ ‡å‡†çš„ REST æ¥å£
- âœ… **JSON/HTML å“åº”** - æ”¯æŒå¤šç§å“åº”æ ¼å¼
- âœ… **å•å…ƒæµ‹è¯•** - å®Œæ•´çš„æµ‹è¯•è¦†ç›–
- âœ… **æ¨¡å—åŒ–è®¾è®¡** - æ˜“äºæ‰©å±•å’Œç»´æŠ¤

## ğŸ“ æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Router (è·¯ç”±å±‚)              â”‚
â”‚  - è¯·æ±‚åˆ†å‘                          â”‚
â”‚  - è·¯ç”±åŒ¹é…                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Controller (æ§åˆ¶å™¨å±‚)           â”‚
â”‚  - HealthController                 â”‚
â”‚  - MessageController                â”‚
â”‚  - PageController                   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service å±‚   â”‚   â”‚   View å±‚       â”‚
â”‚ - ä¸šåŠ¡é€»è¾‘   â”‚   â”‚   - JSON æ¸²æŸ“   â”‚
â”‚              â”‚   â”‚   - HTML æ¸²æŸ“   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Model (æ¨¡å‹å±‚)               â”‚
â”‚  - æ•°æ®ç»“æ„å®šä¹‰                      â”‚
â”‚  - æ•°æ®éªŒè¯                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### API ç«¯ç‚¹

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | å“åº”æ ¼å¼ |
|------|------|------|----------|
| GET | `/` | æ¬¢è¿é¡µé¢ | HTML |
| GET | `/health` | å¥åº·æ£€æŸ¥ | JSON |
| GET | `/api/hello` | Hello API | JSON |
| POST | `/api/echo` | Echo API | JSON |

### å“åº”ç¤ºä¾‹

**å¥åº·æ£€æŸ¥** (`GET /health`):
```json
{
  "success": true,
  "message": "æœåŠ¡å™¨è¿è¡Œæ­£å¸¸",
  "data": {
    "status": "healthy",
    "version": "0.1.0",
    "uptime": 3600
  }
}
```

**Echo API** (`POST /api/echo`):
```bash
# è¯·æ±‚
curl -X POST http://localhost:3000/api/echo \
  -H "Content-Type: application/json" \
  -d '{"message": "Hello, Rust!"}'

# å“åº”
{
  "success": true,
  "message": "Echo æˆåŠŸ",
  "data": {
    "echo": "Hello, Rust!",
    "length": 12,
    "timestamp": "2026-01-12T10:30:00+08:00"
  }
}
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
app2/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs                      # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ router.rs                    # è·¯ç”±å™¨
â”‚   â”œâ”€â”€ models/                      # æ¨¡å‹å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ api_response.rs          # API å“åº”ç»“æ„
â”‚   â”‚   â”œâ”€â”€ health.rs                # å¥åº·æ£€æŸ¥æ¨¡å‹
â”‚   â”‚   â””â”€â”€ message.rs               # æ¶ˆæ¯æ¨¡å‹
â”‚   â”œâ”€â”€ views/                       # è§†å›¾å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ json_view.rs             # JSON è§†å›¾
â”‚   â”‚   â””â”€â”€ html_view.rs             # HTML è§†å›¾
â”‚   â”œâ”€â”€ controllers/                 # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ health_controller.rs     # å¥åº·æ£€æŸ¥æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ message_controller.rs    # æ¶ˆæ¯æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ page_controller.rs       # é¡µé¢æ§åˆ¶å™¨
â”‚   â””â”€â”€ services/                    # æœåŠ¡å±‚
â”‚       â”œâ”€â”€ mod.rs
â”‚       â”œâ”€â”€ health_service.rs        # å¥åº·æ£€æŸ¥æœåŠ¡
â”‚       â””â”€â”€ message_service.rs       # æ¶ˆæ¯æœåŠ¡
â”œâ”€â”€ templates/                       # HTML æ¨¡æ¿
â”‚   â””â”€â”€ home.html                    # é¦–é¡µæ¨¡æ¿
â”œâ”€â”€ test_api.sh                      # API æµ‹è¯•è„šæœ¬
â”œâ”€â”€ Cargo.toml                       # ä¾èµ–é…ç½®
â”œâ”€â”€ README.md                        # é¡¹ç›®è¯´æ˜ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â””â”€â”€ ARCHITECTURE.md                  # è¯¦ç»†æ¶æ„æ–‡æ¡£
```

## ğŸƒ è¿è¡ŒæœåŠ¡å™¨

### å¼€å‘æ¨¡å¼
```bash
cargo run --bin app2
```

### ç”Ÿäº§æ¨¡å¼
```bash
cargo run --bin app2 --release
```

æœåŠ¡å™¨å°†åœ¨ `http://127.0.0.1:3000` å¯åŠ¨ã€‚

## ğŸ§ª æµ‹è¯• API

### ä½¿ç”¨æµ‹è¯•è„šæœ¬
```bash
cd app2
./test_api.sh
```

### æ‰‹åŠ¨æµ‹è¯•

**æµ‹è¯•æ¬¢è¿é¡µé¢**:
```bash
curl http://localhost:3000/
```

**æµ‹è¯•å¥åº·æ£€æŸ¥**:
```bash
curl http://localhost:3000/health
```

**æµ‹è¯• Hello API**:
```bash
curl http://localhost:3000/api/hello
```

**æµ‹è¯• Echo API**:
```bash
curl -X POST http://localhost:3000/api/echo \
  -H "Content-Type: application/json" \
  -d '{"message": "Hello, Rust!"}'
```

### ä½¿ç”¨æµè§ˆå™¨

ç›´æ¥è®¿é—®:
- http://localhost:3000/ - æ¬¢è¿é¡µé¢ï¼ˆå±•ç¤º MVC æ¶æ„ï¼‰
- http://localhost:3000/health - å¥åº·æ£€æŸ¥
- http://localhost:3000/api/hello - Hello API

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **Tokio** - å¼‚æ­¥è¿è¡Œæ—¶
- **Hyper** - HTTP åº“
- **Serde** - åºåˆ—åŒ–/ååºåˆ—åŒ–
- **Chrono** - æ—¶é—´å¤„ç†

## ğŸ¯ MVC å„å±‚èŒè´£

### Model (æ¨¡å‹å±‚)
- å®šä¹‰æ•°æ®ç»“æ„
- å®ç°æ•°æ®éªŒè¯
- ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘

### View (è§†å›¾å±‚)
- æ¸²æŸ“ JSON å“åº”
- æ¸²æŸ“ HTML é¡µé¢
- è®¾ç½® HTTP å¤´

### Controller (æ§åˆ¶å™¨å±‚)
- å¤„ç† HTTP è¯·æ±‚
- è°ƒç”¨ Service å±‚
- ä½¿ç”¨ View å±‚æ¸²æŸ“å“åº”

### Service (æœåŠ¡å±‚)
- å®ç°ä¸šåŠ¡é€»è¾‘
- æ•°æ®å¤„ç†å’Œè½¬æ¢
- å¯è¢«å¤šä¸ª Controller å¤ç”¨

## ğŸ§ª è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test -p app2

# è¿è¡Œç‰¹å®šæµ‹è¯•
cargo test -p app2 test_message_service

# æ˜¾ç¤ºæµ‹è¯•è¾“å‡º
cargo test -p app2 -- --nocapture
```

## ğŸ“ æ·»åŠ æ–°ç«¯ç‚¹

è¯¦ç»†çš„æ‰©å±•æŒ‡å—è¯·å‚è€ƒ [ARCHITECTURE.md](./ARCHITECTURE.md)ã€‚

ç®€è¦æ­¥éª¤ï¼š
1. åœ¨ `models/` å®šä¹‰æ•°æ®æ¨¡å‹
2. åœ¨ `services/` å®ç°ä¸šåŠ¡é€»è¾‘
3. åœ¨ `controllers/` åˆ›å»ºæ§åˆ¶å™¨
4. åœ¨ `router.rs` æ·»åŠ è·¯ç”±

## ğŸ” æ—¥å¿—è¾“å‡º

æœåŠ¡å™¨ä¼šè®°å½•æ‰€æœ‰è¯·æ±‚ï¼š

```
ğŸš€ æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼
ğŸ“ ç›‘å¬åœ°å€: http://127.0.0.1:3000
ğŸ—ï¸  æ¶æ„æ¨¡å¼: MVC
ğŸ“ å¯ç”¨ç«¯ç‚¹:
   GET  /          - æ¬¢è¿é¡µé¢
   GET  /health    - å¥åº·æ£€æŸ¥
   GET  /api/hello - Hello API
   POST /api/echo  - Echo API

æŒ‰ Ctrl+C åœæ­¢æœåŠ¡å™¨

ğŸ“¨ GET / - æ¥è‡ª 127.0.0.1:54321
ğŸ“¨ POST /api/echo - æ¥è‡ª 127.0.0.1:54322
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ARCHITECTURE.md](./ARCHITECTURE.md) - è¯¦ç»†æ¶æ„è¯´æ˜
- [Tokio æ–‡æ¡£](https://tokio.rs)
- [Hyper æ–‡æ¡£](https://hyper.rs)
- [Serde æ–‡æ¡£](https://serde.rs)

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- âœ… å¼‚æ­¥ HTTP æœåŠ¡å™¨ï¼ˆåŸºäº Tokio + Hyperï¼‰
- âœ… RESTful API ç«¯ç‚¹
- âœ… JSON è¯·æ±‚/å“åº”å¤„ç†
- âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹
- âœ… ç¾è§‚çš„æ¬¢è¿é¡µé¢
- âœ… è¯·æ±‚æ—¥å¿—è®°å½•
- âœ… é”™è¯¯å¤„ç†

## ğŸ“¡ API ç«¯ç‚¹

### GET /
æ¬¢è¿é¡µé¢ï¼Œå±•ç¤ºæœåŠ¡å™¨ä¿¡æ¯å’Œå¯ç”¨ç«¯ç‚¹ã€‚

**å“åº”**: HTML é¡µé¢

### GET /health
å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼Œè¿”å›æœåŠ¡å™¨çŠ¶æ€ã€‚

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "æœåŠ¡å™¨è¿è¡Œæ­£å¸¸",
  "data": {
    "status": "healthy",
    "version": "0.1.0"
  }
}
```

### GET /api/hello
ç®€å•çš„ Hello APIã€‚

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "è¯·æ±‚æˆåŠŸ",
  "data": {
    "message": "Hello from App2 Server!",
    "timestamp": "2026-01-12T10:30:00+08:00"
  }
}
```

### POST /api/echo
Echo APIï¼Œè¿”å›å‘é€çš„æ¶ˆæ¯ã€‚

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "message": "Hello, World!"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "Echo æˆåŠŸ",
  "data": {
    "echo": "Hello, World!",
    "length": 13
  }
}
```

## ğŸƒ è¿è¡ŒæœåŠ¡å™¨

### å¼€å‘æ¨¡å¼
```bash
cargo run --bin app2
```

### ç”Ÿäº§æ¨¡å¼
```bash
cargo run --bin app2 --release
```

æœåŠ¡å™¨å°†åœ¨ `http://127.0.0.1:3000` å¯åŠ¨ã€‚

## ğŸ§ª æµ‹è¯• API

### ä½¿ç”¨ curl

**æµ‹è¯•æ¬¢è¿é¡µé¢**:
```bash
curl http://localhost:3000/
```

**æµ‹è¯•å¥åº·æ£€æŸ¥**:
```bash
curl http://localhost:3000/health
```

**æµ‹è¯• Hello API**:
```bash
curl http://localhost:3000/api/hello
```

**æµ‹è¯• Echo API**:
```bash
curl -X POST http://localhost:3000/api/echo \
  -H "Content-Type: application/json" \
  -d '{"message": "Hello, Rust!"}'
```

### ä½¿ç”¨æµè§ˆå™¨

ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®:
- http://localhost:3000/ - æŸ¥çœ‹æ¬¢è¿é¡µé¢
- http://localhost:3000/health - æŸ¥çœ‹å¥åº·çŠ¶æ€
- http://localhost:3000/api/hello - æŸ¥çœ‹ Hello API å“åº”

## ğŸ“ é¡¹ç›®ç»“æ„

```
app2/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs      # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ server.rs    # æœåŠ¡å™¨å®ç°
â”œâ”€â”€ Cargo.toml       # ä¾èµ–é…ç½®
â””â”€â”€ README.md        # é¡¹ç›®è¯´æ˜
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **Tokio** - å¼‚æ­¥è¿è¡Œæ—¶
- **Hyper** - HTTP åº“
- **Serde** - åºåˆ—åŒ–/ååºåˆ—åŒ–
- **Chrono** - æ—¶é—´å¤„ç†

## ğŸ”§ é…ç½®

æœåŠ¡å™¨é…ç½®åœ¨ `main.rs` ä¸­ï¼š

```rust
let config = ServerConfig {
    host: "127.0.0.1".to_string(),
    port: 3000,
};
```

å¯ä»¥ä¿®æ”¹ `host` å’Œ `port` æ¥æ›´æ”¹ç›‘å¬åœ°å€ã€‚

## ğŸ“ æ—¥å¿—è¾“å‡º

æœåŠ¡å™¨ä¼šè®°å½•æ‰€æœ‰è¯·æ±‚ï¼š

```
ğŸš€ æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼
ğŸ“ ç›‘å¬åœ°å€: http://127.0.0.1:3000
ğŸ“ å¯ç”¨ç«¯ç‚¹:
   GET  /          - æ¬¢è¿é¡µé¢
   GET  /health    - å¥åº·æ£€æŸ¥
   GET  /api/hello - Hello API
   POST /api/echo  - Echo API

æŒ‰ Ctrl+C åœæ­¢æœåŠ¡å™¨

ğŸ“¨ GET / - æ¥è‡ª 127.0.0.1:54321
ğŸ“¨ GET /health - æ¥è‡ª 127.0.0.1:54322
```

## ğŸš¦ é”™è¯¯å¤„ç†

æœåŠ¡å™¨ä¼šè¿”å›é€‚å½“çš„ HTTP çŠ¶æ€ç ï¼š

- `200 OK` - è¯·æ±‚æˆåŠŸ
- `400 Bad Request` - è¯·æ±‚æ ¼å¼é”™è¯¯
- `404 Not Found` - ç«¯ç‚¹ä¸å­˜åœ¨
- `500 Internal Server Error` - æœåŠ¡å™¨é”™è¯¯

## ğŸ”„ æ‰©å±•åŠŸèƒ½

å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„ç«¯ç‚¹ï¼š

1. åœ¨ `server.rs` çš„ `handle_request` å‡½æ•°ä¸­æ·»åŠ æ–°è·¯ç”±
2. å®ç°å¯¹åº”çš„å¤„ç†å‡½æ•°
3. å®šä¹‰è¯·æ±‚/å“åº”æ•°æ®ç»“æ„

ç¤ºä¾‹ï¼š
```rust
(&Method::GET, "/api/users") => handle_users(),
```

## ğŸ“š ç›¸å…³èµ„æº

- [Tokio æ–‡æ¡£](https://tokio.rs)
- [Hyper æ–‡æ¡£](https://hyper.rs)
- [Serde æ–‡æ¡£](https://serde.rs)

## ğŸ“„ è®¸å¯è¯

MIT License
